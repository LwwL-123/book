# Go 闭包

首先一道题目，以下代码输出什么？

```GO
package main

import "fmt"

func app() func(string) string {
 t := "Hi"
 c := func(b string) string {
  t = t + " " + b
  return t
 }
 return c
}

func main() {
 a := app()
 b := app()
 a("go")
 fmt.Println(b("All"))
 fmt.Println(a("All"))
}
///
/// Hi All
/// Hi go All
```



## 01 什么是闭包

维基百科对闭包的定义：

> 在计算机科学中，闭包（英语：Closure），又称词法闭包（Lexical Closure）或函数闭包（function closures），是在支持头等函数的编程语言中实现词法绑定的一种技术。闭包在实现上是一个结构体，它存储了一个函数（通常是其入口地址）和一个关联的环境（相当于一个符号查找表）。环境里是若干对符号和值的对应关系，它既要包括约束变量（该函数内部绑定的符号），也要包括自由变量（在函数外部定义但在函数内被引用），有些函数也可能没有自由变量。闭包跟函数最大的不同在于，当捕捉闭包的时候，它的自由变量会在捕捉时被确定，这样即便脱离了捕捉时的上下文，它也能照常运行。捕捉时对于值的处理可以是值拷贝，也可以是名称引用，这通常由语言设计者决定，也可能由用户自行指定（如 C++）。

关于（函数）闭包，有几个关键点：

- 函数是一等公民；
- 闭包所处环境，可以引用环境里的值

